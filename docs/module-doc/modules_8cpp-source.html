<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>modules.cpp Source File</title>
<link href="inspircd.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>modules.cpp</h1><a href="modules_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"></span>
00003 <span class="comment"></span>
00004 <span class="comment">*/</span>
00005 
00006 
00007 
00008 <span class="preprocessor">#include &lt;typeinfo&gt;</span>
00009 <span class="preprocessor">#include &lt;iostream&gt;</span>
00010 <span class="preprocessor">#include "globals.h"</span>
00011 <span class="preprocessor">#include "<a class="code" href="modules_8h.html">modules.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="ctables_8h.html">ctables.h</a>"</span>
00013 <span class="preprocessor">#include "inspircd_io.h"</span>
00014 <span class="preprocessor">#include "wildcard.h"</span>
00015 <span class="preprocessor">#include "<a class="code" href="mode_8h.html">mode.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="message_8h.html">message.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="commands_8h.html">commands.h</a>"</span>
00018 
00019 <span class="comment">// class type for holding an extended mode character - internal to core</span>
00020 
<a name="l00021"></a><a class="code" href="classExtMode.html">00021</a> <span class="keyword">class </span><a class="code" href="classExtMode.html">ExtMode</a> : <span class="keyword">public</span> <a class="code" href="classclassbase.html">classbase</a>
00022 {
00023 <span class="keyword">public</span>:
<a name="l00024"></a><a class="code" href="classExtMode.html#m0">00024</a>         <span class="keywordtype">char</span> <a class="code" href="classExtMode.html#m0">modechar</a>;
<a name="l00025"></a><a class="code" href="classExtMode.html#m1">00025</a>         <span class="keywordtype">int</span> <a class="code" href="classExtMode.html#m1">type</a>;
<a name="l00026"></a><a class="code" href="classExtMode.html#m2">00026</a>         <span class="keywordtype">int</span> <a class="code" href="classExtMode.html#m2">params_when_on</a>;
<a name="l00027"></a><a class="code" href="classExtMode.html#m3">00027</a>         <span class="keywordtype">int</span> <a class="code" href="classExtMode.html#m3">params_when_off</a>;
<a name="l00028"></a><a class="code" href="classExtMode.html#m4">00028</a>         <span class="keywordtype">bool</span> <a class="code" href="classExtMode.html#m4">needsoper</a>;
<a name="l00029"></a><a class="code" href="classExtMode.html#a0">00029</a>         <a class="code" href="classExtMode.html#a0">ExtMode</a>(<span class="keywordtype">char</span> mc, <span class="keywordtype">int</span> ty, <span class="keywordtype">bool</span> oper, <span class="keywordtype">int</span> p_on, <span class="keywordtype">int</span> p_off) : modechar(mc), type(ty), needsoper(oper), params_when_on(p_on), params_when_off(p_off) { };
00030 };                                     
00031 
<a name="l00032"></a><a class="code" href="modules_8cpp.html#a0">00032</a> <span class="keyword">typedef</span> std::vector&lt;ExtMode&gt; <a class="code" href="modules_8cpp.html#a0">ExtModeList</a>;
<a name="l00033"></a><a class="code" href="modules_8cpp.html#a1">00033</a> <span class="keyword">typedef</span> ExtModeList::iterator <a class="code" href="modules_8cpp.html#a1">ExtModeListIter</a>;
00034 
<a name="l00035"></a><a class="code" href="modules_8cpp.html#a2">00035</a> <a class="code" href="modules_8cpp.html#a0">ExtModeList</a> <a class="code" href="modules_8cpp.html#a2">EMode</a>;
00036 
00037 <span class="comment">// returns true if an extended mode character is in use</span>
<a name="l00038"></a><a class="code" href="modules_8cpp.html#a4">00038</a> <span class="keywordtype">bool</span> <a class="code" href="modules_8cpp.html#a4">ModeDefined</a>(<span class="keywordtype">char</span> modechar, <span class="keywordtype">int</span> type)
00039 {
00040         log(DEBUG,<span class="stringliteral">"Size of extmodes vector is %d"</span>,<a class="code" href="modules_8cpp.html#a2">EMode</a>.size());
00041         <span class="keywordflow">for</span> (<a class="code" href="modules_8cpp.html#a1">ExtModeListIter</a> i = <a class="code" href="modules_8cpp.html#a2">EMode</a>.begin(); i &lt; <a class="code" href="modules_8cpp.html#a2">EMode</a>.end(); i++)
00042         {
00043                 log(DEBUG,<span class="stringliteral">"i-&gt;modechar==%c, modechar=%c, i-&gt;type=%d, type=%d"</span>,i-&gt;modechar,modechar,i-&gt;type,type);
00044                 <span class="keywordflow">if</span> ((i-&gt;modechar == modechar) &amp;&amp; (i-&gt;type == type))
00045                 {
00046                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00047                 }
00048         }
00049         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00050 }
00051 
<a name="l00052"></a><a class="code" href="modules_8cpp.html#a5">00052</a> <span class="keywordtype">bool</span> <a class="code" href="modules_8cpp.html#a5">ModeDefinedOper</a>(<span class="keywordtype">char</span> modechar, <span class="keywordtype">int</span> type)
00053 {
00054         log(DEBUG,<span class="stringliteral">"Size of extmodes vector is %d"</span>,<a class="code" href="modules_8cpp.html#a2">EMode</a>.size());
00055         <span class="keywordflow">for</span> (<a class="code" href="modules_8cpp.html#a1">ExtModeListIter</a> i = <a class="code" href="modules_8cpp.html#a2">EMode</a>.begin(); i &lt; <a class="code" href="modules_8cpp.html#a2">EMode</a>.end(); i++)
00056         {
00057                 log(DEBUG,<span class="stringliteral">"i-&gt;modechar==%c, modechar=%c, i-&gt;type=%d, type=%d"</span>,i-&gt;modechar,modechar,i-&gt;type,type);
00058                 <span class="keywordflow">if</span> ((i-&gt;modechar == modechar) &amp;&amp; (i-&gt;type == type) &amp;&amp; (i-&gt;needsoper == <span class="keyword">true</span>))
00059                 {
00060                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00061                 }
00062         }
00063         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00064 }
00065 
00066 <span class="comment">// returns number of parameters for a custom mode when it is switched on</span>
<a name="l00067"></a><a class="code" href="modules_8cpp.html#a6">00067</a> <span class="keywordtype">int</span> <a class="code" href="modules_8cpp.html#a6">ModeDefinedOn</a>(<span class="keywordtype">char</span> modechar, <span class="keywordtype">int</span> type)
00068 {
00069         <span class="keywordflow">for</span> (<a class="code" href="modules_8cpp.html#a1">ExtModeListIter</a> i = <a class="code" href="modules_8cpp.html#a2">EMode</a>.begin(); i &lt; <a class="code" href="modules_8cpp.html#a2">EMode</a>.end(); i++)
00070         {
00071                 <span class="keywordflow">if</span> ((i-&gt;modechar == modechar) &amp;&amp; (i-&gt;type == type))
00072                 {
00073                         <span class="keywordflow">return</span> i-&gt;params_when_on;
00074                 }
00075         }
00076         <span class="keywordflow">return</span> 0;
00077 }
00078 
00079 <span class="comment">// returns number of parameters for a custom mode when it is switched on</span>
<a name="l00080"></a><a class="code" href="modules_8cpp.html#a7">00080</a> <span class="keywordtype">int</span> <a class="code" href="modules_8cpp.html#a7">ModeDefinedOff</a>(<span class="keywordtype">char</span> modechar, <span class="keywordtype">int</span> type)
00081 {
00082         <span class="keywordflow">for</span> (<a class="code" href="modules_8cpp.html#a1">ExtModeListIter</a> i = <a class="code" href="modules_8cpp.html#a2">EMode</a>.begin(); i &lt; <a class="code" href="modules_8cpp.html#a2">EMode</a>.end(); i++)
00083         {
00084                 <span class="keywordflow">if</span> ((i-&gt;modechar == modechar) &amp;&amp; (i-&gt;type == type))
00085                 {
00086                         <span class="keywordflow">return</span> i-&gt;params_when_off;
00087                 }
00088         }
00089         <span class="keywordflow">return</span> 0;
00090 }
00091 
00092 <span class="comment">// returns true if an extended mode character is in use</span>
<a name="l00093"></a><a class="code" href="modules_8cpp.html#a8">00093</a> <span class="keywordtype">bool</span> <a class="code" href="modules_8cpp.html#a8">DoAddExtendedMode</a>(<span class="keywordtype">char</span> modechar, <span class="keywordtype">int</span> type, <span class="keywordtype">bool</span> requires_oper, <span class="keywordtype">int</span> params_on, <span class="keywordtype">int</span> params_off)
00094 {
00095         <span class="keywordflow">if</span> (<a class="code" href="modules_8cpp.html#a4">ModeDefined</a>(modechar,type)) {
00096                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00097         }
00098         <a class="code" href="modules_8cpp.html#a2">EMode</a>.push_back(<a class="code" href="classExtMode.html">ExtMode</a>(modechar,type,requires_oper,params_on,params_off));
00099         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00100 }
00101 
00102 
00103 <span class="comment">// version is a simple class for holding a modules version number</span>
00104 
<a name="l00105"></a><a class="code" href="classVersion.html#a0">00105</a> <a class="code" href="classVersion.html#a0">Version::Version</a>(<span class="keywordtype">int</span> major, <span class="keywordtype">int</span> minor, <span class="keywordtype">int</span> revision, <span class="keywordtype">int</span> build) : Major(major), Minor(minor), Revision(revision), Build(build) { };
00106 
00107 <span class="comment">// admin is a simple class for holding a server's administrative info</span>
00108 
<a name="l00109"></a><a class="code" href="classAdmin.html#a0">00109</a> <a class="code" href="classAdmin.html#a0">Admin::Admin</a>(std::string name, std::string email, std::string nick) : Name(name), Email(email), Nick(nick) { };
00110 
<a name="l00111"></a><a class="code" href="classModule.html#a0">00111</a> <a class="code" href="classModule.html#a0">Module::Module</a>() { }
<a name="l00112"></a><a class="code" href="classModule.html#a1">00112</a> <a class="code" href="classModule.html#a1">Module::~Module</a>() { }
<a name="l00113"></a><a class="code" href="classModule.html#a3">00113</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a3">Module::OnUserConnect</a>(<a class="code" href="classuserrec.html">userrec</a>* user) { }
<a name="l00114"></a><a class="code" href="classModule.html#a4">00114</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a4">Module::OnUserQuit</a>(<a class="code" href="classuserrec.html">userrec</a>* user) { }
<a name="l00115"></a><a class="code" href="classModule.html#a5">00115</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a5">Module::OnUserJoin</a>(<a class="code" href="classuserrec.html">userrec</a>* user, <a class="code" href="classchanrec.html">chanrec</a>* channel) { }
<a name="l00116"></a><a class="code" href="classModule.html#a6">00116</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a6">Module::OnUserPart</a>(<a class="code" href="classuserrec.html">userrec</a>* user, <a class="code" href="classchanrec.html">chanrec</a>* channel) { }
<a name="l00117"></a><a class="code" href="classModule.html#a7">00117</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a7">Module::OnPacketTransmit</a>(<span class="keywordtype">char</span> *p) { }
<a name="l00118"></a><a class="code" href="classModule.html#a8">00118</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a8">Module::OnPacketReceive</a>(<span class="keywordtype">char</span> *p) { }
<a name="l00119"></a><a class="code" href="classModule.html#a9">00119</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a9">Module::OnRehash</a>() { }
<a name="l00120"></a><a class="code" href="classModule.html#a10">00120</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a10">Module::OnServerRaw</a>(std::string &amp;raw, <span class="keywordtype">bool</span> inbound, <a class="code" href="classuserrec.html">userrec</a>* user) { }
<a name="l00121"></a><a class="code" href="classModule.html#a12">00121</a> <span class="keywordtype">int</span> <a class="code" href="classModule.html#a12">Module::OnUserPreJoin</a>(<a class="code" href="classuserrec.html">userrec</a>* user, <a class="code" href="classchanrec.html">chanrec</a>* chan, <span class="keyword">const</span> <span class="keywordtype">char</span>* cname) { <span class="keywordflow">return</span> 0; }
<a name="l00122"></a><a class="code" href="classModule.html#a11">00122</a> <span class="keywordtype">bool</span> <a class="code" href="classModule.html#a11">Module::OnExtendedMode</a>(<a class="code" href="classuserrec.html">userrec</a>* user, <span class="keywordtype">void</span>* target, <span class="keywordtype">char</span> modechar, <span class="keywordtype">int</span> type, <span class="keywordtype">bool</span> mode_on, string_list &amp;params) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00123"></a><a class="code" href="classModule.html#a2">00123</a> <a class="code" href="classVersion.html">Version</a> <a class="code" href="classModule.html#a2">Module::GetVersion</a>() { <span class="keywordflow">return</span> <a class="code" href="classVersion.html">Version</a>(1,0,0,0); }
<a name="l00124"></a><a class="code" href="classModule.html#a13">00124</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a13">Module::OnOper</a>(<a class="code" href="classuserrec.html">userrec</a>* user) { };
<a name="l00125"></a><a class="code" href="classModule.html#a14">00125</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a14">Module::OnInfo</a>(<a class="code" href="classuserrec.html">userrec</a>* user) { };
<a name="l00126"></a><a class="code" href="classModule.html#a15">00126</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#a15">Module::OnWhois</a>(<a class="code" href="classuserrec.html">userrec</a>* source, <a class="code" href="classuserrec.html">userrec</a>* dest) { };
<a name="l00127"></a><a class="code" href="classModule.html#a16">00127</a> <span class="keywordtype">int</span> <a class="code" href="classModule.html#a16">Module::OnUserPreMessage</a>(<a class="code" href="classuserrec.html">userrec</a>* user,<span class="keywordtype">void</span>* dest,<span class="keywordtype">int</span> target_type, std::string text) { <span class="keywordflow">return</span> 0; };
<a name="l00128"></a><a class="code" href="classModule.html#a17">00128</a> <span class="keywordtype">int</span> <a class="code" href="classModule.html#a17">Module::OnUserPreNotice</a>(<a class="code" href="classuserrec.html">userrec</a>* user,<span class="keywordtype">void</span>* dest,<span class="keywordtype">int</span> target_type, std::string text) { <span class="keywordflow">return</span> 0; };
<a name="l00129"></a><a class="code" href="classModule.html#a18">00129</a> <span class="keywordtype">int</span> <a class="code" href="classModule.html#a18">Module::OnUserPreNick</a>(<a class="code" href="classuserrec.html">userrec</a>* user, std::string newnick) { <span class="keywordflow">return</span> 0; };
00130 
00131 <span class="comment">// server is a wrapper class that provides methods to all of the C-style</span>
00132 <span class="comment">// exports in the core</span>
00133 <span class="comment">//</span>
00134 
<a name="l00135"></a><a class="code" href="classServer.html#a0">00135</a> <a class="code" href="classServer.html#a0">Server::Server</a>()
00136 {
00137 }
00138 
<a name="l00139"></a><a class="code" href="classServer.html#a1">00139</a> <a class="code" href="classServer.html#a1">Server::~Server</a>()
00140 {
00141 }
00142 
<a name="l00143"></a><a class="code" href="classServer.html#a2">00143</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a2">Server::SendOpers</a>(std::string s)
00144 {
00145         WriteOpers(<span class="stringliteral">"%s"</span>,s.c_str());
00146 }
00147 
<a name="l00148"></a><a class="code" href="classServer.html#a28">00148</a> <span class="keywordtype">bool</span> <a class="code" href="classServer.html#a28">Server::MatchText</a>(std::string sliteral, std::string spattern)
00149 {
00150         <span class="keywordtype">char</span> literal[MAXBUF],pattern[MAXBUF];
00151         strncpy(literal,sliteral.c_str(),MAXBUF);
00152         strncpy(pattern,spattern.c_str(),MAXBUF);
00153         <span class="keywordflow">return</span> match(literal,pattern);
00154 }
00155 
<a name="l00156"></a><a class="code" href="classServer.html#a23">00156</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a23">Server::SendToModeMask</a>(std::string modes, <span class="keywordtype">int</span> flags, std::string text)
00157 {
00158         WriteMode(modes.c_str(),flags,<span class="stringliteral">"%s"</span>,text.c_str());
00159 }
00160 
<a name="l00161"></a><a class="code" href="classServer.html#a24">00161</a> <a class="code" href="classchanrec.html">chanrec</a>* <a class="code" href="classServer.html#a24">Server::JoinUserToChannel</a>(<a class="code" href="classuserrec.html">userrec</a>* user, std::string cname, std::string key)
00162 {
00163         <span class="keywordflow">return</span> add_channel(user,cname.c_str(),key.c_str(),<span class="keyword">true</span>);
00164 }
00165 
<a name="l00166"></a><a class="code" href="classServer.html#a25">00166</a> <a class="code" href="classchanrec.html">chanrec</a>* <a class="code" href="classServer.html#a25">Server::PartUserFromChannel</a>(<a class="code" href="classuserrec.html">userrec</a>* user, std::string cname, std::string reason)
00167 {
00168         <span class="keywordflow">return</span> del_channel(user,cname.c_str(),reason.c_str(),<span class="keyword">false</span>);
00169 }
00170 
<a name="l00171"></a><a class="code" href="classServer.html#a26">00171</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a26">Server::ChangeUserNick</a>(<a class="code" href="classuserrec.html">userrec</a>* user, std::string nickname)
00172 {
00173         force_nickchange(user,nickname.c_str());
00174 }
00175 
<a name="l00176"></a><a class="code" href="classServer.html#a27">00176</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a27">Server::QuitUser</a>(<a class="code" href="classuserrec.html">userrec</a>* user, std::string reason)
00177 {
00178         <a class="code" href="message_8h.html#a19">send_network_quit</a>(user-&gt;<a class="code" href="classuserrec.html#m0">nick</a>,reason.c_str());
00179         kill_link(user,reason.c_str());
00180 }
00181 
<a name="l00182"></a><a class="code" href="classServer.html#a32">00182</a> <span class="keywordtype">bool</span> <a class="code" href="classServer.html#a32">Server::IsUlined</a>(std::string server)
00183 {
00184         <span class="keywordflow">return</span> <a class="code" href="commands_8h.html#a70">is_uline</a>(server.c_str());
00185 }
00186 
<a name="l00187"></a><a class="code" href="classServer.html#a29">00187</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a29">Server::CallCommandHandler</a>(std::string commandname, <span class="keywordtype">char</span>** parameters, <span class="keywordtype">int</span> pcnt, <a class="code" href="classuserrec.html">userrec</a>* user)
00188 {
00189         call_handler(commandname.c_str(),parameters,pcnt,user);
00190 }
00191 
<a name="l00192"></a><a class="code" href="classServer.html#a3">00192</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a3">Server::Log</a>(<span class="keywordtype">int</span> level, std::string s)
00193 {
00194         log(level,<span class="stringliteral">"%s"</span>,s.c_str());
00195 }
00196 
<a name="l00197"></a><a class="code" href="classServer.html#a21">00197</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a21">Server::AddCommand</a>(<span class="keywordtype">char</span>* cmd, handlerfunc f, <span class="keywordtype">char</span> flags, <span class="keywordtype">int</span> minparams)
00198 {
00199         <a class="code" href="modules_8h.html#a13">createcommand</a>(cmd,f,flags,minparams);
00200 }
00201 
<a name="l00202"></a><a class="code" href="classServer.html#a22">00202</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a22">Server::SendMode</a>(<span class="keywordtype">char</span> **parameters, <span class="keywordtype">int</span> pcnt, <a class="code" href="classuserrec.html">userrec</a> *user)
00203 {
00204         <a class="code" href="modules_8h.html#a14">server_mode</a>(parameters,pcnt,user);
00205 }
00206 
<a name="l00207"></a><a class="code" href="classServer.html#a4">00207</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a4">Server::Send</a>(<span class="keywordtype">int</span> Socket, std::string s)
00208 {
00209         Write(Socket,<span class="stringliteral">"%s"</span>,s.c_str());
00210 }
00211 
<a name="l00212"></a><a class="code" href="classServer.html#a5">00212</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a5">Server::SendServ</a>(<span class="keywordtype">int</span> Socket, std::string s)
00213 {
00214         WriteServ(Socket,<span class="stringliteral">"%s"</span>,s.c_str());
00215 }
00216 
<a name="l00217"></a><a class="code" href="classServer.html#a6">00217</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a6">Server::SendFrom</a>(<span class="keywordtype">int</span> Socket, <a class="code" href="classuserrec.html">userrec</a>* User, std::string s)
00218 {
00219         WriteFrom(Socket,User,<span class="stringliteral">"%s"</span>,s.c_str());
00220 }
00221 
<a name="l00222"></a><a class="code" href="classServer.html#a7">00222</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a7">Server::SendTo</a>(<a class="code" href="classuserrec.html">userrec</a>* Source, <a class="code" href="classuserrec.html">userrec</a>* Dest, std::string s)
00223 {
00224         <span class="keywordflow">if</span> (!Source)
00225         {
00226                 <span class="comment">// if source is NULL, then the message originates from the local server</span>
00227                 Write(Dest-&gt;<a class="code" href="classconnection.html#m0">fd</a>,<span class="stringliteral">":%s %s"</span>,this-&gt;GetServerName().c_str(),s.c_str());
00228         }
00229         <span class="keywordflow">else</span>
00230         {
00231                 <span class="comment">// otherwise it comes from the user specified</span>
00232                 WriteTo(Source,Dest,<span class="stringliteral">"%s"</span>,s.c_str());
00233         }
00234 }
00235 
<a name="l00236"></a><a class="code" href="classServer.html#a8">00236</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a8">Server::SendChannel</a>(<a class="code" href="classuserrec.html">userrec</a>* User, <a class="code" href="classchanrec.html">chanrec</a>* Channel, std::string s,<span class="keywordtype">bool</span> IncludeSender)
00237 {
00238         <span class="keywordflow">if</span> (IncludeSender)
00239         {
00240                 WriteChannel(Channel,User,<span class="stringliteral">"%s"</span>,s.c_str());
00241         }
00242         <span class="keywordflow">else</span>
00243         {
00244                 ChanExceptSender(Channel,User,<span class="stringliteral">"%s"</span>,s.c_str());
00245         }
00246 }
00247 
<a name="l00248"></a><a class="code" href="classServer.html#a9">00248</a> <span class="keywordtype">bool</span> <a class="code" href="classServer.html#a9">Server::CommonChannels</a>(<a class="code" href="classuserrec.html">userrec</a>* u1, <a class="code" href="classuserrec.html">userrec</a>* u2)
00249 {
00250         <span class="keywordflow">return</span> (<a class="code" href="message_8h.html#a0">common_channels</a>(u1,u2) != 0);
00251 }
00252 
<a name="l00253"></a><a class="code" href="classServer.html#a10">00253</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a10">Server::SendCommon</a>(<a class="code" href="classuserrec.html">userrec</a>* User, std::string text,<span class="keywordtype">bool</span> IncludeSender)
00254 {
00255         <span class="keywordflow">if</span> (IncludeSender)
00256         {
00257                 WriteCommon(User,<span class="stringliteral">"%s"</span>,text.c_str());
00258         }
00259         <span class="keywordflow">else</span>
00260         {
00261                 WriteCommonExcept(User,<span class="stringliteral">"%s"</span>,text.c_str());
00262         }
00263 }
00264 
<a name="l00265"></a><a class="code" href="classServer.html#a11">00265</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a11">Server::SendWallops</a>(<a class="code" href="classuserrec.html">userrec</a>* User, std::string text)
00266 {
00267         WriteWallOps(User,<span class="keyword">false</span>,<span class="stringliteral">"%s"</span>,text.c_str());
00268 }
00269 
<a name="l00270"></a><a class="code" href="classServer.html#a30">00270</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a30">Server::ChangeHost</a>(<a class="code" href="classuserrec.html">userrec</a>* user, std::string host)
00271 {
00272         <a class="code" href="message_8h.html#a11">ChangeDisplayedHost</a>(user,host.c_str());
00273 }
00274 
<a name="l00275"></a><a class="code" href="classServer.html#a31">00275</a> <span class="keywordtype">void</span> <a class="code" href="classServer.html#a31">Server::ChangeGECOS</a>(<a class="code" href="classuserrec.html">userrec</a>* user, std::string gecos)
00276 {
00277         <a class="code" href="message_8h.html#a10">ChangeName</a>(user,gecos.c_str());
00278 }
00279 
<a name="l00280"></a><a class="code" href="classServer.html#a12">00280</a> <span class="keywordtype">bool</span> <a class="code" href="classServer.html#a12">Server::IsNick</a>(std::string nick)
00281 {
00282         <span class="keywordflow">return</span> (<a class="code" href="message_8h.html#a13">isnick</a>(nick.c_str()) != 0);
00283 }
00284 
<a name="l00285"></a><a class="code" href="classServer.html#a14">00285</a> <a class="code" href="classuserrec.html">userrec</a>* <a class="code" href="classServer.html#a14">Server::FindNick</a>(std::string nick)
00286 {
00287         <span class="keywordflow">return</span> Find(nick);
00288 }
00289 
<a name="l00290"></a><a class="code" href="classServer.html#a15">00290</a> <a class="code" href="classchanrec.html">chanrec</a>* <a class="code" href="classServer.html#a15">Server::FindChannel</a>(std::string channel)
00291 {
00292         <span class="keywordflow">return</span> FindChan(channel.c_str());
00293 }
00294 
<a name="l00295"></a><a class="code" href="classServer.html#a16">00295</a> std::string <a class="code" href="classServer.html#a16">Server::ChanMode</a>(<a class="code" href="classuserrec.html">userrec</a>* User, <a class="code" href="classchanrec.html">chanrec</a>* Chan)
00296 {
00297         <span class="keywordflow">return</span> <a class="code" href="message_8h.html#a14">cmode</a>(User,Chan);
00298 }
00299 
<a name="l00300"></a><a class="code" href="classServer.html#a17">00300</a> std::string <a class="code" href="classServer.html#a17">Server::GetServerName</a>()
00301 {
00302         <span class="keywordflow">return</span> getservername();
00303 }
00304 
<a name="l00305"></a><a class="code" href="classServer.html#a18">00305</a> std::string <a class="code" href="classServer.html#a18">Server::GetNetworkName</a>()
00306 {
00307         <span class="keywordflow">return</span> getnetworkname();
00308 }
00309 
<a name="l00310"></a><a class="code" href="classServer.html#a19">00310</a> <a class="code" href="classAdmin.html">Admin</a> <a class="code" href="classServer.html#a19">Server::GetAdmin</a>()
00311 {
00312         <span class="keywordflow">return</span> <a class="code" href="classAdmin.html">Admin</a>(getadminname(),getadminemail(),getadminnick());
00313 }
00314 
00315 
00316 
<a name="l00317"></a><a class="code" href="classServer.html#a20">00317</a> <span class="keywordtype">bool</span> <a class="code" href="classServer.html#a20">Server::AddExtendedMode</a>(<span class="keywordtype">char</span> modechar, <span class="keywordtype">int</span> type, <span class="keywordtype">bool</span> requires_oper, <span class="keywordtype">int</span> params_when_on, <span class="keywordtype">int</span> params_when_off)
00318 {
00319         <span class="keywordflow">if</span> (type == <a class="code" href="modules_8h.html#a7">MT_SERVER</a>)
00320         {
00321                 log(DEBUG,<span class="stringliteral">"*** API ERROR *** Modes of type MT_SERVER are reserved for future expansion"</span>);
00322                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00323         }
00324         <span class="keywordflow">if</span> (((params_when_on&gt;0) || (params_when_off&gt;0)) &amp;&amp; (type == <a class="code" href="modules_8h.html#a6">MT_CLIENT</a>))
00325         {
00326                 log(DEBUG,<span class="stringliteral">"*** API ERROR *** Parameters on MT_CLIENT modes are not supported"</span>);
00327                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00328         }
00329         <span class="keywordflow">if</span> ((params_when_on&gt;1) || (params_when_off&gt;1))
00330         {
00331                 log(DEBUG,<span class="stringliteral">"*** API ERROR *** More than one parameter for an MT_CHANNEL mode is not yet supported"</span>);
00332                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00333         }
00334         <span class="keywordflow">return</span> <a class="code" href="modules_8cpp.html#a8">DoAddExtendedMode</a>(modechar,type,requires_oper,params_when_on,params_when_off);
00335 }
00336 
<a name="l00337"></a><a class="code" href="classServer.html#a13">00337</a> <span class="keywordtype">int</span> <a class="code" href="classServer.html#a13">Server::CountUsers</a>(<a class="code" href="classchanrec.html">chanrec</a>* c)
00338 {
00339         <span class="keywordflow">return</span> usercount(c);
00340 }
00341 
00342 
<a name="l00343"></a><a class="code" href="classConfigReader.html#a0">00343</a> <a class="code" href="classConfigReader.html#a0">ConfigReader::ConfigReader</a>()
00344 {
00345         this-&gt;<a class="code" href="classConfigReader.html#n0">cache</a> = <span class="keyword">new</span> std::stringstream(std::stringstream::in | std::stringstream::out);
00346         this-&gt;<a class="code" href="classConfigReader.html#n1">error</a> = LoadConf(CONFIG_FILE,this-&gt;cache);
00347 }
00348 
00349 
<a name="l00350"></a><a class="code" href="classConfigReader.html#a2">00350</a> <a class="code" href="classConfigReader.html#a2">ConfigReader::~ConfigReader</a>()
00351 {
00352         <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classConfigReader.html#n0">cache</a>)
00353                 <span class="keyword">delete</span> this-&gt;<a class="code" href="classConfigReader.html#n0">cache</a>;
00354 }
00355 
00356 
<a name="l00357"></a><a class="code" href="classConfigReader.html#a1">00357</a> <a class="code" href="classConfigReader.html#a0">ConfigReader::ConfigReader</a>(std::string filename)
00358 {
00359         this-&gt;<a class="code" href="classConfigReader.html#n0">cache</a> = <span class="keyword">new</span> std::stringstream(std::stringstream::in | std::stringstream::out);
00360         this-&gt;<a class="code" href="classConfigReader.html#n1">error</a> = LoadConf(filename.c_str(),this-&gt;<a class="code" href="classConfigReader.html#n0">cache</a>);
00361 };
00362 
<a name="l00363"></a><a class="code" href="classConfigReader.html#a3">00363</a> std::string <a class="code" href="classConfigReader.html#a3">ConfigReader::ReadValue</a>(std::string tag, std::string name, <span class="keywordtype">int</span> index)
00364 {
00365         <span class="keywordtype">char</span> val[MAXBUF];
00366         <span class="keywordtype">char</span> t[MAXBUF];
00367         <span class="keywordtype">char</span> n[MAXBUF];
00368         strncpy(t,tag.c_str(),MAXBUF);
00369         strncpy(n,name.c_str(),MAXBUF);
00370         ReadConf(cache,t,n,index,val);
00371         <span class="keywordflow">return</span> std::string(val);
00372 }
00373 
00374 
<a name="l00375"></a><a class="code" href="classConfigReader.html#a4">00375</a> <span class="keywordtype">int</span> <a class="code" href="classConfigReader.html#a4">ConfigReader::Enumerate</a>(std::string tag)
00376 {
00377         <span class="keywordflow">return</span> EnumConf(cache,tag.c_str());
00378 }
00379 
<a name="l00380"></a><a class="code" href="classConfigReader.html#a6">00380</a> <span class="keywordtype">int</span> <a class="code" href="classConfigReader.html#a6">ConfigReader::EnumerateValues</a>(std::string tag, <span class="keywordtype">int</span> index)
00381 {
00382         <span class="keywordflow">return</span> EnumValues(cache, tag.c_str(), index);
00383 }
00384 
<a name="l00385"></a><a class="code" href="classConfigReader.html#a5">00385</a> <span class="keywordtype">bool</span> <a class="code" href="classConfigReader.html#a5">ConfigReader::Verify</a>()
00386 {
00387         <span class="keywordflow">return</span> this-&gt;<a class="code" href="classConfigReader.html#n1">error</a>;
00388 }
00389 
00390 
<a name="l00391"></a><a class="code" href="classFileReader.html#a1">00391</a> <a class="code" href="classFileReader.html#a0">FileReader::FileReader</a>(std::string filename)
00392 {
00393         <a class="code" href="modules_8h.html#a10">file_cache</a> c;
00394         readfile(c,filename.c_str());
00395         this-&gt;<a class="code" href="classFileReader.html#o0">fc</a> = c;
00396 }
00397 
<a name="l00398"></a><a class="code" href="classFileReader.html#a0">00398</a> <a class="code" href="classFileReader.html#a0">FileReader::FileReader</a>()
00399 {
00400 }
00401 
<a name="l00402"></a><a class="code" href="classFileReader.html#a3">00402</a> <span class="keywordtype">void</span> <a class="code" href="classFileReader.html#a3">FileReader::LoadFile</a>(std::string filename)
00403 {
00404         <a class="code" href="modules_8h.html#a10">file_cache</a> c;
00405         readfile(c,filename.c_str());
00406         this-&gt;<a class="code" href="classFileReader.html#o0">fc</a> = c;
00407 }
00408 
00409 
<a name="l00410"></a><a class="code" href="classFileReader.html#a2">00410</a> <a class="code" href="classFileReader.html#a2">FileReader::~FileReader</a>()
00411 {
00412 }
00413 
<a name="l00414"></a><a class="code" href="classFileReader.html#a4">00414</a> <span class="keywordtype">bool</span> <a class="code" href="classFileReader.html#a4">FileReader::Exists</a>()
00415 {
00416         <span class="keywordflow">if</span> (<a class="code" href="classFileReader.html#o0">fc</a>.size() == 0)
00417         {
00418                 <span class="keywordflow">return</span>(false);
00419         }
00420         <span class="keywordflow">else</span>
00421         {
00422                 <span class="keywordflow">return</span>(true);
00423         }
00424 }
00425 
<a name="l00426"></a><a class="code" href="classFileReader.html#a5">00426</a> std::string <a class="code" href="classFileReader.html#a5">FileReader::GetLine</a>(<span class="keywordtype">int</span> x)
00427 {
00428         <span class="keywordflow">if</span> ((x&lt;0) || (x&gt;<a class="code" href="classFileReader.html#o0">fc</a>.size()))
00429                 <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
00430         <span class="keywordflow">return</span> <a class="code" href="classFileReader.html#o0">fc</a>[x];
00431 }
00432 
<a name="l00433"></a><a class="code" href="classFileReader.html#a6">00433</a> <span class="keywordtype">int</span> <a class="code" href="classFileReader.html#a6">FileReader::FileSize</a>()
00434 {
00435         <span class="keywordflow">return</span> <a class="code" href="classFileReader.html#o0">fc</a>.size();
00436 }
00437 
00438 
00439 std::vector&lt;Module*&gt; <a class="code" href="modules_8cpp.html#a9">modules</a>(255);
00440 std::vector&lt;ircd_module*&gt; <a class="code" href="modules_8cpp.html#a10">factory</a>(255);
00441 
<a name="l00442"></a><a class="code" href="modules_8cpp.html#a3">00442</a> <span class="keywordtype">int</span> <a class="code" href="modules_8cpp.html#a3">MODCOUNT</a>  = -1;
00443 
00444 
</pre></div><hr><address style="align: right;"><small>Generated on Thu Apr 29 16:30:32 2004 for InspIRCd by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
